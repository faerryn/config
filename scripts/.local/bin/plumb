#!/bin/sh
set -eu
EDITOR=${EDITOR:-nvim}
MIMETYPE=
PROGRAM=

if [ ! -r "${1}" ]; then
	return 1
fi

MIMETYPE="$(file -bL --mime-type "${1}")"

case "${MIMETYPE}" in
	audio/* | video/*)
		PROGRAM=mpv
		;;
	image/svg+xml)
		PROGRAM=inkview
		;;
	image/*)
		PROGRAM=sxiv
		;;
	text/*)
		PROGRAM="${EDITOR}"
		;;

	application/json)
		PROGRAM="${EDITOR}"
		;;
	application/pdf)
		PROGRAM=katarakt
		;;
	application/*)
		PROGRAM=mpv
		;;

	inode/directory)
		PROGRAM=Thunar
		;;
	inode/x-empty)
		PROGRAM="${EDITOR}"
		;;

	*)
		>&2 echo "no program associated with mimetype ${MIMETYPE}"
		return 1
		;;
esac

exec run $PROGRAM "$@"
